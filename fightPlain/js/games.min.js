"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();!function(t,e){var a=t,n=e,s=null,i=a.getElementById("canvas"),d=i.getContext("2d"),y=a.getElementById("startBtn"),h=a.getElementById("aboutBtn"),m=a.getElementById("welcome"),l=a.getElementById("pause"),u=a.getElementById("mask"),o=a.getElementById("topRank"),r=a.getElementById("nowRank"),p=a.getElementById("continue"),c=!0,P=!1,x=null;i.width=a.body.clientWidth,i.height=a.body.clientHeight,n.onresize=function(){i.width=a.body.clientWidth,i.height=a.body.clientHeight},h.addEventListener("touchstart",function(){alert("本作品由Mrdai独立完成")},!1),l.addEventListener("touchend",function(){c?(l.style.backgroundImage='url("img/Fav_Voice_Play-hd.png")',c=!1):(l.style.backgroundImage='url("img/Fav_Voice_Pause-hd.png")',c=!0)},!1);var E=function(){function t(e,a){var i=this;_classCallCheck(this,t),this.canvas=e,this.ctx=a,this.nowRank=0,this.topRank=0,this.gameStatus=!0,this.gravityMode=!1,this.img=new Image,this.img.src="img/gameArts.png",this.bg={speed:2,ready:!1,bg1:{x:0,y:0},bg2:{x:0,y:-this.canvas.height}},this.player={x:this.canvas.width/2,y:this.canvas.height-88,normalPos:[{x:432,y:332},{x:432,y:0}],diePos:[{x:432,y:250},{x:432,y:85},{x:432,y:168}],sX:null,sY:null,count:0,dieCount:0,dieStatus:!1,animationTime:200,animation:function(){i.player.dieStatus?setTimeout(function(){switch(s.player.dieCount){case 0:s.player.sX=s.player.diePos[0].x,s.player.sY=s.player.diePos[0].y,s.player.dieCount++;break;case 1:s.player.sX=s.player.diePos[1].x,s.player.sY=s.player.diePos[1].y,s.player.dieCount++;break;case 2:s.player.sX=s.player.diePos[2].x,s.player.sY=s.player.diePos[2].y,s.player.dieCount++;break;case 3:n.cancelAnimationFrame(x),s.player.dieCount++;break;default:return u.style.display="block",0}s.player.animation()},s.player.animationTime):setTimeout(function(){1===s.player.count?(s.player.count=0,s.player.sX=s.player.normalPos[0].x,s.player.sY=s.player.normalPos[0].y):(s.player.sX=s.player.normalPos[1].x,s.player.sY=s.player.normalPos[1].y,s.player.count++),s.player.animation()},s.player.animationTime)}},this.pos={x:this.canvas.width/2,y:this.canvas.height-33},this.bullet={speed:15,interval:100,power:10,dataPound:[{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1},{x:this.player.x,y:this.player.y,status:!1}],useBullet:function(){if(!s.gameStatus)return 0;for(var t=0;t<this.dataPound.length;t++)if(!this.dataPound[t].status){this.dataPound[t].status=!0,this.dataPound[t].x=s.player.x+33;break}setTimeout(function(){s.bullet.useBullet()},s.bullet.interval)},moveBullet:function(){for(var t=0;t<this.dataPound.length;t++)this.dataPound[t].status&&(this.dataPound[t].y-=this.speed)},resetBullet:function(t){return this.dataPound[t].status=!1,this.dataPound[t].y=s.player.y,this.dataPound[t]}},this.enemy={animationTime:150,simpleEnemy:{speed:4,score:50,dataPound:[{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width+40)-40,y:-2,sX:82,sY:658,hp:50,displayStatus:!1,dieStatus:!1}],diePos:[{x:50,y:658},{x:420,y:734},{x:475,y:723}],dieCount:0},middleEnemy:{speed:2,score:200,dataPound:[{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-45),y:-60,sX:0,sY:570,hp:100,displayStatus:!1,dieStatus:!1}],diePos:[{x:430,y:540},{x:430,y:600},{x:430,y:480}],dieCount:0},hardEnemy:{speed:1,score:500,dataPound:[{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1},{x:Math.random()*(this.canvas.width-110),y:-165,sX:220,sY:850,hp:300,displayStatus:!1,dieStatus:!1}],diePos:[{x:0,y:750},{x:320,y:340},{x:320,y:0}],dieCount:0},animation:function(t,e){var a="simpleEnemy";switch(e){case 0:a="simpleEnemy";break;case 1:a="middleEnemy";break;case 2:a="hardEnemy"}setTimeout(function(){switch(s.enemy[a].dieCount){case 0:s.enemy[a].dataPound[t].dieStatus=!1,s.enemy[a].dataPound[t].sX=s.enemy[a].diePos[0].x,s.enemy[a].dataPound[t].sY=s.enemy[a].diePos[0].y,s.enemy[a].dieCount++;break;case 1:s.enemy[a].dataPound[t].sX=s.enemy[a].diePos[1].x,s.enemy[a].dataPound[t].sY=s.enemy[a].diePos[1].y,s.enemy[a].dieCount++;break;case 2:s.enemy[a].dataPound[t].sX=s.enemy[a].diePos[2].x,s.enemy[a].dataPound[t].sY=s.enemy[a].diePos[2].y,s.enemy[a].dieCount++;break;default:return s.enemy.resetEnemy(t,e),0}s.enemy.animation(t,e)},s.enemy.animationTime)},createEnemy:function(){if(!i.gameStatus)return 0;var t=Math.floor(10*Math.random());if(0===t||1===t||2===t||3===t||4===t||5===t||6===t){for(var e=0;e<i.enemy.simpleEnemy.dataPound.length;e++)if(!i.enemy.simpleEnemy.dataPound[e].displayStatus){i.enemy.simpleEnemy.dataPound[e].displayStatus=!0,i.enemy.simpleEnemy.dataPound[e].dieStatus=!0;break}}else if(7===t||8===t){for(var e=0;e<i.enemy.middleEnemy.dataPound.length;e++)if(!i.enemy.middleEnemy.dataPound[e].displayStatus){i.enemy.middleEnemy.dataPound[e].displayStatus=!0,i.enemy.middleEnemy.dataPound[e].dieStatus=!0;break}}else if(9===t)for(var e=0;e<i.enemy.hardEnemy.dataPound.length;e++)if(!i.enemy.hardEnemy.dataPound[e].displayStatus){i.enemy.hardEnemy.dataPound[e].displayStatus=!0,i.enemy.hardEnemy.dataPound[e].dieStatus=!0;break}setTimeout(function(){s.enemy.createEnemy()},800)},moveEnemy:function(){for(var t=0;t<i.enemy.simpleEnemy.dataPound.length;t++)i.enemy.simpleEnemy.dataPound[t].dieStatus&&(i.enemy.simpleEnemy.dataPound[t].y+=i.enemy.simpleEnemy.speed);for(var t=0;t<i.enemy.middleEnemy.dataPound.length;t++)i.enemy.middleEnemy.dataPound[t].dieStatus&&(i.enemy.middleEnemy.dataPound[t].y+=i.enemy.middleEnemy.speed);for(var t=0;t<i.enemy.hardEnemy.dataPound.length;t++)i.enemy.hardEnemy.dataPound[t].dieStatus&&(i.enemy.hardEnemy.dataPound[t].y+=i.enemy.hardEnemy.speed)},resetEnemy:function(t,e){var a=null;switch(e){case 0:a="simpleEnemy",i.enemy[a].dataPound[t].x=Math.random()*(i.canvas.width-32),i.enemy[a].dataPound[t].y=-20,i.enemy[a].dataPound[t].sX=82,i.enemy[a].dataPound[t].sY=658,i.enemy[a].dataPound[t].hp=50;break;case 1:a="middleEnemy",i.enemy[a].dataPound[t].x=Math.random()*(i.canvas.width-45),i.enemy[a].dataPound[t].y=-60,i.enemy[a].dataPound[t].sX=0,i.enemy[a].dataPound[t].sY=570,i.enemy[a].dataPound[t].hp=100;break;case 2:a="hardEnemy",i.enemy[a].dataPound[t].x=Math.random()*(i.canvas.width-110),i.enemy[a].dataPound[t].y=-165,i.enemy[a].dataPound[t].sX=220,i.enemy[a].dataPound[t].sY=850,i.enemy[a].dataPound[t].hp=300}i.enemy[a].dieCount=0,i.enemy[a].dataPound[t].dieStatus=!1,i.enemy[a].dataPound[t].displayStatus=!1}},s=this}return _createClass(t,[{key:"processUserInput",value:function(){var t=this;this.gravityMode||(addEventListener("touchstart",function(t){var e=n.event||t;e.preventDefault()},!1),addEventListener("touchmove",function(e){var a=n.event||e;t.pos.x=a.targetTouches[0].clientX,t.pos.y=a.targetTouches[0].clientY,t.pos.x<32&&(t.pos.x=32),t.pos.y<55&&(t.pos.y=55),t.pos.x>t.canvas.width-32&&(t.pos.x=t.canvas.width-32),t.pos.y>t.canvas.height-25&&(t.pos.y=t.canvas.height-25)},!1))}},{key:"loadImg",value:function(){var t=this;this.img.onload=function(){return t.bg.ready=!0}}},{key:"isPlayerDie",value:function(){for(var t=0;t<this.enemy.simpleEnemy.dataPound.length;t++)if(this.enemy.simpleEnemy.dataPound[t].dieStatus&&this.player.x<=this.enemy.simpleEnemy.dataPound[t].x+30&&this.player.x+64>=this.enemy.simpleEnemy.dataPound[t].x&&this.player.y<=this.enemy.simpleEnemy.dataPound[t].y+22&&this.player.y+80>=this.enemy.simpleEnemy.dataPound[t].y)return!0;for(var t=0;t<this.enemy.middleEnemy.dataPound.length;t++)if(this.enemy.middleEnemy.dataPound[t].dieStatus&&this.player.x<=this.enemy.middleEnemy.dataPound[t].x+45&&this.player.x+64>=this.enemy.middleEnemy.dataPound[t].x&&this.player.y<=this.enemy.middleEnemy.dataPound[t].y+57&&this.player.y+80>=this.enemy.middleEnemy.dataPound[t].y)return!0;for(var t=0;t<this.enemy.hardEnemy.dataPound.length;t++)if(this.enemy.hardEnemy.dataPound[t].dieStatus&&this.player.x<=this.enemy.hardEnemy.dataPound[t].x+110&&this.player.x+64>=this.enemy.hardEnemy.dataPound[t].x&&this.player.y<=this.enemy.hardEnemy.dataPound[t].y+170&&this.player.y+80>=this.enemy.hardEnemy.dataPound[t].y)return!0;return!1}},{key:"isEnemyDie",value:function(){for(var t={bool:!1,count:null,levelEnemy:null},e=0;e<this.bullet.dataPound.length;e++)if(this.bullet.dataPound[e].status){for(var a=0;a<this.enemy.simpleEnemy.dataPound.length;a++)if(this.enemy.simpleEnemy.dataPound[a].dieStatus&&this.bullet.dataPound[e].x+10>this.enemy.simpleEnemy.dataPound[a].x&&this.bullet.dataPound[e].x<this.enemy.simpleEnemy.dataPound[a].x+30&&this.bullet.dataPound[e].y<this.enemy.simpleEnemy.dataPound[a].y+22&&this.bullet.dataPound[e].y+10>this.enemy.simpleEnemy.dataPound[a].y)return this.bullet.resetBullet(e),t.bool=!0,t.count=a,t.levelEnemy="simpleEnemy",t;for(var a=0;a<this.enemy.middleEnemy.dataPound.length;a++)if(this.enemy.middleEnemy.dataPound[a].dieStatus&&this.bullet.dataPound[e].x+10>this.enemy.middleEnemy.dataPound[a].x&&this.bullet.dataPound[e].x<this.enemy.middleEnemy.dataPound[a].x+45&&this.bullet.dataPound[e].y<this.enemy.middleEnemy.dataPound[a].y+57&&this.bullet.dataPound[e].y+10>this.enemy.middleEnemy.dataPound[a].y)return this.bullet.resetBullet(e),t.bool=!0,t.count=a,t.levelEnemy="middleEnemy",t;for(var a=0;a<this.enemy.hardEnemy.dataPound.length;a++)if(this.enemy.hardEnemy.dataPound[a].dieStatus&&this.bullet.dataPound[e].x+10>this.enemy.hardEnemy.dataPound[a].x&&this.bullet.dataPound[e].x<this.enemy.hardEnemy.dataPound[a].x+110&&this.bullet.dataPound[e].y<this.enemy.hardEnemy.dataPound[a].y+170&&this.bullet.dataPound[e].y+10>this.enemy.hardEnemy.dataPound[a].y)return this.bullet.resetBullet(e),t.bool=!0,t.count=a,t.levelEnemy="hardEnemy",t}return t}},{key:"update",value:function(){this.bg.bg1.y>=this.canvas.height&&(this.bg.bg1.y=-this.canvas.height),this.bg.bg2.y>=this.canvas.height&&(this.bg.bg2.y=-this.canvas.height),this.bg.bg1.y+=this.bg.speed,this.bg.bg2.y+=this.bg.speed,this.player.x=this.pos.x-33,this.player.y=this.pos.y-55,this.isPlayerDie()&&(this.player.dieStatus=!0,this.player.animation(),this.gameStatus=!1,localStorage.getItem("topRank")||localStorage.setItem("topRank",0),this.topRank=localStorage.getItem("topRank"),this.topRank<this.nowRank&&(this.topRank=this.nowRank),o.innerHTML=this.topRank,r.innerHTML=this.nowRank,localStorage.setItem("topRank",this.topRank)),this.bullet.moveBullet(),this.enemy.moveEnemy();var t=this.isEnemyDie();if(t.bool&&(this.enemy[t.levelEnemy].dataPound[t.count].hp-=this.bullet.power,this.enemy[t.levelEnemy].dataPound[t.count].hp<=0)){this.nowRank+=this.enemy[t.levelEnemy].score,this.enemy[t.levelEnemy].dataPound[t.count].dieStatus=!1;var e=null;switch(t.levelEnemy){case"simpleEnemy":e=0;break;case"middleEnemy":e=1;break;case"hardEnemy":e=2}this.enemy.animation(t.count,e)}}},{key:"render",value:function(){if(this.bg.ready){this.ctx.drawImage(this.img,0,0,320,568,this.bg.bg1.x,this.bg.bg1.y,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0,320,568,this.bg.bg2.x,this.bg.bg2.y,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,this.player.sX,this.player.sY,64,80,this.player.x,this.player.y,64,80);for(var t=0;t<this.bullet.dataPound.length;t++)this.bullet.dataPound[t].status&&(this.bullet.dataPound[t].y<=0?this.bullet.resetBullet(t):this.ctx.drawImage(this.img,0,730,10,10,this.bullet.dataPound[t].x,this.bullet.dataPound[t].y,10,10));for(var t=0;t<this.enemy.simpleEnemy.dataPound.length;t++)this.enemy.simpleEnemy.dataPound[t].displayStatus&&(this.enemy.simpleEnemy.dataPound[t].y>this.canvas.height?this.enemy.resetEnemy(t,0):this.ctx.drawImage(this.img,this.enemy.simpleEnemy.dataPound[t].sX,this.enemy.simpleEnemy.dataPound[t].sY,32,25,this.enemy.simpleEnemy.dataPound[t].x,this.enemy.simpleEnemy.dataPound[t].y,32,25));for(var t=0;t<this.enemy.middleEnemy.dataPound.length;t++)this.enemy.middleEnemy.dataPound[t].displayStatus&&(this.enemy.middleEnemy.dataPound[t].y>this.canvas.height?this.enemy.resetEnemy(t,1):this.ctx.drawImage(this.img,this.enemy.middleEnemy.dataPound[t].sX,this.enemy.middleEnemy.dataPound[t].sY,45,57,this.enemy.middleEnemy.dataPound[t].x,this.enemy.middleEnemy.dataPound[t].y,45,57));for(var t=0;t<this.enemy.hardEnemy.dataPound.length;t++)this.enemy.hardEnemy.dataPound[t].displayStatus&&(this.enemy.hardEnemy.dataPound[t].y>this.canvas.height?this.enemy.resetEnemy(t,2):this.ctx.drawImage(this.img,this.enemy.hardEnemy.dataPound[t].sX,this.enemy.hardEnemy.dataPound[t].sY,110,170,this.enemy.hardEnemy.dataPound[t].x,this.enemy.hardEnemy.dataPound[t].y,110,170));this.ctx.fillStyle="rgb(250, 250, 250)",this.ctx.font="20px Helvetica",this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText("score: "+this.nowRank,60,20)}}},{key:"main",value:function(){s.update(),s.render(),x=requestAnimationFrame(function(){s.main()})}},{key:"start",value:function(){this.processUserInput(),this.loadImg(),this.player.animation(),this.bullet.useBullet(),this.enemy.createEnemy(),this.main()}}]),t}(),v=function(t,e){return new E(t,e)},g=null,b=function(){m.style.display="none",i.style.display="block",l.style.display="block";var t=v(i,d);return t.start(),t},S=function(){u.style.display="none",i.style.display="none",l.style.display="none",m.style.display="block"},f=function(){P?(g.gameStatus=!0,g.start(),P=!1):(n.cancelAnimationFrame(x),g.gameStatus=!1,P=!0)};y.addEventListener("touchstart",function(){g=b()},!1),p.addEventListener("touchstart",S,!1),l.addEventListener("touchstart",f,!1)}(document,window);